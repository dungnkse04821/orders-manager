@page
@model OrdersManager.Pages.Customers.CustomerModel
@{
    ViewData["Title"] = "Danh sách khách hàng";
}

<div class="row mb-3 align-items-center">
    <div class="col-md-6">
        <h2 class="text-primary"><i class="bi bi-people-fill"></i> Khách Hàng</h2>
    </div>
    <div class="col-md-6 text-end">
        <a href="./Create" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Thêm khách mới
        </a>
    </div>
</div>

<div class="card mb-4 shadow-sm">
    <div class="card-body py-2">
        <form method="get" class="row g-2">
            <div class="col-md-10">
                <input type="text" name="SearchTerm" class="form-control"
                       placeholder="Tìm theo tên hoặc số điện thoại..."
                       value="@Model.SearchTerm">
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Tìm kiếm</button>
            </div>
        </form>
    </div>
</div>

<div class="table-responsive bg-white shadow-sm rounded">
    <table class="table table-hover mb-0">
        <thead class="table-light">
            <tr>
                <th>Họ và tên</th>
                <th>Số điện thoại</th>
                <th>Địa chỉ</th>
                <th>Reference</th>
                <th>Ghi chú</th>
                <th class="text-center" style="width: 150px;">Thao tác</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Customers.Count == 0)
            {
                <tr>
                    <td colspan="5" class="text-center py-4 text-muted">
                        Không tìm thấy dữ liệu khách hàng nào.
                    </td>
                </tr>
            }
            else
            {
                @foreach (var item in Model.Customers)
                {
                    <tr>
                        <td class="fw-bold text-primary">@item.FullName</td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.PhoneNumber))
                            {
                                <a href="tel:@item.PhoneNumber" class="text-decoration-none text-dark">
                                    <i class="bi bi-telephone"></i> @item.PhoneNumber
                                </a>
                            }
                        </td>
                        <td>@item.Address</td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.Reference))
                            {
                                var uri = new Uri(item.Reference);
                                var host = uri.Host.ToLower();

                                string label = "Link";
                                string icon = "bi-link-45deg";

                                if (host.Contains("facebook.com"))
                                {
                                    label = "Facebook";
                                    icon = "bi-facebook";
                                }
                                else if (host.Contains("instagram.com"))
                                {
                                    label = "Instagram";
                                    icon = "bi-instagram";
                                }
                                else if (host.Contains("t.me") || host.Contains("telegram.org"))
                                {
                                    label = "Telegram";
                                    icon = "bi-telegram";
                                }
                                else if (host.Contains("zalo.me"))
                                {
                                    label = "Zalo";
                                    icon = "bi-chat-dots"; // Zalo không có icon chính thức trong BI
                                }
                                else if (host.Contains("youtube.com") || host.Contains("youtu.be"))
                                {
                                    label = "YouTube";
                                    icon = "bi-youtube";
                                }
                                else if (host.Contains("tiktok.com"))
                                {
                                    label = "TikTok";
                                    icon = "bi-tiktok";
                                }

                                <a href="@item.Reference"
                                   class="text-decoration-none text-dark d-inline-flex align-items-center gap-1"
                                   target="_blank"
                                   rel="noopener noreferrer">
                                    <i class="bi @icon"></i> @label
                                </a>
                            }
                        </td>
                        <td class="text-muted small">@item.Note</td>
                        <td class="text-center">
                            <div class="btn-group" role="group">
                                <a asp-page="./Edit" asp-route-id="@item.Id" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-pencil-square"></i> Sửa
                                </a>

                                <form method="post" asp-page-handler="Delete" asp-route-id="@item.Id"
                                      style="display:inline;"
                                      onsubmit="return confirm('Bạn có chắc muốn xóa khách hàng này?');">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">
                                        <i class="bi bi-trash"></i> Xóa
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>
